{% from "partial/icon.html" import icon %}

<style>
.theme-switch-btn {
    position: fixed;
    right: 2rem;
    bottom: 2rem;
    z-index: 1000;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    background-color: var(--muted);
    border: none;
}

.theme-switch-btn .icon {
    width: 20px;
    height: 20px;
}

.dark-icon, .light-icon {
    position: absolute;
}
</style>

<button class="theme-switch-btn" id="theme-switch-btn" title="Toggle theme">
    <span class="dark-icon" id="dark-icon">{{ icon('dark_mode', '', '20') }}</span>
    <span class="light-icon" id="light-icon">{{ icon('light_mode', '', '20') }}</span>
</button>

<script>
document.getElementById('theme-switch-btn').onclick = () => {
    const current = document.documentElement.getAttribute('data-theme');
    const next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    
    // Toggle icon visibility
    document.getElementById('dark-icon').style.display = next === 'dark' ? 'none' : 'block';
    document.getElementById('light-icon').style.display = next === 'dark' ? 'block' : 'none';
    
    // Toggle syntax highlighting CSS
    document.getElementById('syntax-light').disabled = next === 'dark';
    document.getElementById('syntax-dark').disabled = next !== 'dark';
    
    localStorage.setItem('theme', next);
};

// Load preferred theme on page load
window.addEventListener('DOMContentLoaded', () => {
    let theme;
    
    // First try localStorage
    const savedTheme = localStorage.getItem('theme');
    
    if (savedTheme) {
        theme = savedTheme;
    } else {
        // Fall back to browser preference
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        theme = prefersDark ? 'dark' : 'light';
    }
    
    document.documentElement.setAttribute('data-theme', theme);
    
    // Set initial icon visibility based on theme
    document.getElementById('dark-icon').style.display = theme === 'dark' ? 'none' : 'block';
    document.getElementById('light-icon').style.display = theme === 'dark' ? 'block' : 'none';
    
    // Set initial syntax highlighting based on theme
    document.getElementById('syntax-light').disabled = theme === 'dark';
    document.getElementById('syntax-dark').disabled = theme !== 'dark';
});
</script>
